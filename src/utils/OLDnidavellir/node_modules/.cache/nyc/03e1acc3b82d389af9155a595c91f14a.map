{"version":3,"file":"tests.cjs.js","sources":["../src/utils/jsonSearch.js","../test/utils/fixtures/jsonSearch.js","../test/utils/jsonSearch.js"],"sourcesContent":["// @flow\n\nimport { type JsonSearchParams } from '../../types/utils'\n\nexport const search = (searchParams: JsonSearchParams, jsonObj: any): Array<any> => {\n  // If jsonObj is undefined we can't compare anything and so we fail early\n  if (typeof jsonObj === 'undefined') return []\n  const { keyToMatch } = searchParams\n\n  if (!searchParams.tokenizeKeys) {\n    searchParams.tokenizeKeys = keyToMatch ? keyToMatch.split('.') : []\n  }\n\n  const {\n    valueToMatch,\n    // keyToReturn,\n    parent\n  } = searchParams\n\n  let { tokenizeKeys = [] } = searchParams\n  // If we ran out of tokenizeKeys it means we need to verify that we found the right key with the correct value\n  if (!tokenizeKeys.length) {\n    if (typeof valueToMatch === 'undefined' || valueToMatch === jsonObj) {\n      return parent ? [parent] : [jsonObj]\n    }\n  }\n\n  const deepSearch = (parentObj: any, shiftToken?: boolean): Array<any> => {\n    let results = []\n\n    const searchParams = {\n      keyToMatch,\n      valueToMatch,\n      // keyToReturn,\n      parent: parentObj,\n      tokenizeKeys\n    }\n\n    if (shiftToken) {\n      const token = tokenizeKeys[0]\n      searchParams.tokenizeKeys = tokenizeKeys.slice(1)\n      return search(searchParams, parentObj[token])\n    }\n\n    if (!parent) searchParams.parent = undefined\n\n    for (const key in parentObj) {\n      const result = search(searchParams, parentObj[key])\n      results = results.concat(result)\n    }\n\n    return results\n  }\n\n  // If we are searching in an Array, we would go over each child without moving the token counter\n  if (Array.isArray(jsonObj)) return deepSearch(jsonObj)\n\n  const result1 = []\n  // Check for wild card\n  console.log('tokenizeKeys', tokenizeKeys)\n  if (tokenizeKeys[0] === '*') {\n    Array.prototype.push.apply(result1, deepSearch(jsonObj))\n    tokenizeKeys = tokenizeKeys.slice[0]\n  }\n\n  // Shift one level based on the first key in tokenizeKeys with jsonObj as the parent\n  const result2 = deepSearch(jsonObj, true)\n  // If there is no parent yet, it means that we still have the full tokenizeKeys\n  // So we will try to use the same tokenizeKeys for every child of jsonObj\n  const result3 = !parent ? deepSearch(jsonObj) : []\n\n  return [ ...result2, ...result3 ]\n}\n","export const jsonObj = {\n  alpha: 1,\n  bravo: [1, 2, 3],\n  charlie: { delta: 1 },\n  india: {\n    kilo: 4,\n    lima: 4\n  },\n  uniform: {\n    kilo: 4,\n    lima: 4\n  },\n  echo: {\n    foxtrot: [1, 2, 3],\n    golf: {\n      india: {\n        kilo: 4,\n        lima: 4\n      },\n      juliet: {\n        kilo: 4,\n        lima: 5\n      },\n      mike: [\n        { kilo: 4 },\n        6,\n        { lima: 5 },\n        { lima: 6, kilo: 7 },\n        { charlie: { delta: 1 } },\n        { alpha: 1 },\n        [ 6, { lima: 5 }, 10 ]\n      ],\n      november: 8\n    }\n  }\n}\n\nconst working = [\n  [ [], [jsonObj] ],\n  [ ['alpha', 1], [\n    jsonObj,\n    jsonObj['echo']['golf']['mike'][5]\n  ] ],\n  [ ['alpha', 2], [] ],\n  [ ['bravo', 0], [] ],\n  [ ['bravo', 1], [jsonObj['bravo']] ],\n  [ ['charlie', 1], [] ],\n  [ ['charlie.delta', 1], [\n    jsonObj['charlie'],\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ],\n  [ ['india.kilo', 5], [] ],\n  [ ['india.lima', 5], [] ],\n\n  [ ['echo.foxtrot', 2], [\n    jsonObj['echo']['foxtrot']\n  ] ],\n\n  [ ['echo.golf.india.kilo', 4], [jsonObj['echo']['golf']['india']] ],\n  [ ['echo.golf.india.kilo', 5], [] ],\n  [ ['echo.golf.november', 8], [jsonObj['echo']['golf']] ],\n\n  [ ['india.kilo', 4], [\n    jsonObj['india'],\n    jsonObj['echo']['golf']['india']\n  ] ],\n\n  [ ['lima', 5], [\n    jsonObj['echo']['golf']['juliet'],\n    jsonObj['echo']['golf']['mike'][2],\n    jsonObj['echo']['golf']['mike'][6][1]\n  ] ],\n\n  [ ['lima', 4], [\n    jsonObj['india'],\n    jsonObj['uniform'],\n    jsonObj['echo']['golf']['india']\n  ] ],\n\n  [ ['kilo', 4], [\n    jsonObj['india'],\n    jsonObj['uniform'],\n    jsonObj['echo']['golf']['india'],\n    jsonObj['echo']['golf']['juliet'],\n    jsonObj['echo']['golf']['mike'][0]\n  ] ]\n]\n\nexport const fixtures = [\n  // [ ['mike.*.delta', 1], [\n  //   jsonObj['charlie'],\n  //   jsonObj['echo']['golf']['mike'][4]['charlie']\n  // ] ]\n]\n.concat(working)\n","// @flow\n\nimport { assert } from 'chai'\nimport { describe, it } from 'mocha'\n\nimport { search } from '../../src/utils/jsonSearch.js'\nimport { fixtures, jsonObj } from './fixtures/jsonSearch.js'\n\ndescribe('Testing Json Search', function () {\n  fixtures.forEach(([ test, expected ]) => {\n    it(`Testing search with: ${JSON.stringify(test)} `, function () {\n      const searchParams = {\n        keyToMatch: test[0],\n        valueToMatch: test[1]\n        // keyToReturn: test[2]\n      }\n      const results = search(searchParams, jsonObj)\n      // console.log('results', results)\n      // console.log('expected', expected)\n      assert.deepEqual(results, expected)\n    })\n  })\n})\n"],"names":["search","searchParams","jsonObj","keyToMatch","tokenizeKeys","split","valueToMatch","parent","length","deepSearch","parentObj","shiftToken","results","token","slice","undefined","key","result","concat","Array","isArray","result1","console","log","prototype","push","apply","result2","result3","alpha","bravo","charlie","delta","india","kilo","lima","uniform","echo","foxtrot","golf","juliet","mike","november","working","fixtures","describe","forEach","test","expected","it","JSON","stringify","assert","deepEqual"],"mappings":"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"}